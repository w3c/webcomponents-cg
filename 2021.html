<!DOCTYPE html><html lang="en" dir="ltr"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 34.1.6">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
    
<title>Web Components Community Group: 2021 Spec/API status</title>
    
    
  
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<style>
ul.index{columns:30ch;column-gap:1.5em}
ul.index li{list-style:inherit}
ul.index li span{color:inherit;cursor:pointer;white-space:normal}
#index-defined-here ul.index li{font-size:.9rem}
ul.index code{color:inherit}
#index-defined-here .print-only{display:none}
@media print{
#index-defined-here .print-only{display:initial}
}
</style>
<meta name="description" content="This is required.">
<style>
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}
.hljs-comment,.hljs-quote{color:#717277;font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;font-weight:700}
.hljs-literal{color:#0b76c5}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "CG-DRAFT",
  "latestVersion": null,
  "edDraftURI": null,
  "editors": [
    {
      "name": "Westbrook Johnson",
      "url": "https://westbrookjohnson.com"
    },
    {
      "name": "Alan Dávalos",
      "url": "https://github.com/alangdm"
    },
    {
      "name": "Owen Buckley",
      "url": "https://github.com/thescientist13"
    },
    {
      "name": "William Riley",
      "url": "https://github.com/splitinfinities"
    },
    {
      "name": "Justin Fagnani",
      "url": "https://github.com/justinfagnani"
    },
    {
      "name": "Jordan Austin",
      "url": "https://github.com/jordanaustin"
    },
    {
      "name": "Dan Clark",
      "url": "https://github.com/dandclark"
    },
    {
      "name": "Hunter Loftis",
      "url": "https://github.com/hunterloftis"
    },
    {
      "name": "Michael Potter",
      "url": "https://github.com/heymp"
    },
    {
      "name": "Benny Powers",
      "url": "https://github.com/bennypowers"
    }
  ],
  "github": "w3c/webcomponents-cg",
  "shortName": "webcomponents-cg",
  "xref": "web-platform",
  "group": "webcomponents",
  "tocIntroductory": true,
  "publishISODate": "2023-09-11T00:00:00.000Z",
  "generatedSubtitle": "Draft Community Group Report 11 September 2023"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/cg-draft"></head>
  <body class="h-entry" data-cite="HTML INFRA URL WEBIDL DOM FETCH"><div class="head">
    
    <h1 id="title" class="title">Web Components Community Group: 2021 Spec/API status</h1> 
    <p id="w3c-state">
      <a href="https://www.w3.org/standards/types#reports">Draft Community Group Report</a>
      <time class="dt-published" datetime="2023-09-11">11 September 2023</time>
    </p>
    <dl>
      
      <dt>Latest published version:</dt><dd>
              none
            </dd>
      
      
      
      
      
      <dt>Editors:</dt><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://westbrookjohnson.com">Westbrook Johnson</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/alangdm">Alan Dávalos</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/thescientist13">Owen Buckley</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/splitinfinities">William Riley</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/justinfagnani">Justin Fagnani</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/jordanaustin">Jordan Austin</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/dandclark">Dan Clark</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/hunterloftis">Hunter Loftis</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/heymp">Michael Potter</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/bennypowers">Benny Powers</a>
  </dd>
      
      
      <dt>Feedback:</dt><dd>
        <a href="https://github.com/w3c/webcomponents-cg/">GitHub w3c/webcomponents-cg</a>
        (<a href="https://github.com/w3c/webcomponents-cg/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/webcomponents-cg/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/webcomponents-cg/issues/">open issues</a>)
      </dd>
      
    </dl>
    
    <p class="copyright">
          <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
          ©
          2023
          
          the Contributors to the Web Components Community Group: 2021 Spec/API status
          Specification, published by the
          <a href="https://www.w3.org/groups/cg/webcomponents">Web Components Community Group</a> under the
          <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable
                <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a>
                is available.
              
        </p>
    <hr title="Separator for header">
  </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
      <p>This is required.</p>
    </section>
    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/groups/cg/webcomponents">Web Components Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
            there is a limited opt-out and other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p>
      <p>This is required.</p>
    <p>
    <a href="https://github.com/w3c/webcomponents-cg/issues/">GitHub Issues</a> are preferred for
          discussion of this specification.
        
    
  </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a></li><li class="tocline"><a class="tocxref" href="#form-associated-custom-elements"><bdi class="secno">2. </bdi>Form-Associated Custom Elements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description"><bdi class="secno">2.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation"><bdi class="secno">2.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#cross-root-aria"><bdi class="secno">3. </bdi>Cross-root ARIA</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-0"><bdi class="secno">3.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-0"><bdi class="secno">3.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#constructable-stylesheets-adoptedstylesheets"><bdi class="secno">4. </bdi>Constructable Stylesheets &amp; adoptedStyleSheets</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-1"><bdi class="secno">4.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-1"><bdi class="secno">4.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#css-module-scripts"><bdi class="secno">5. </bdi>CSS Module Scripts</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-2"><bdi class="secno">5.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-2"><bdi class="secno">5.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#scoped-element-registries"><bdi class="secno">6. </bdi>Scoped Element Registries</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-3"><bdi class="secno">6.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-3"><bdi class="secno">6.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#declarative-shadow-dom"><bdi class="secno">7. </bdi>Declarative Shadow DOM</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-4"><bdi class="secno">7.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-4"><bdi class="secno">7.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#composed-selection"><bdi class="secno">8. </bdi>Composed Selection</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-5"><bdi class="secno">8.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-5"><bdi class="secno">8.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#declarative-css-modules"><bdi class="secno">9. </bdi>Declarative CSS Modules</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-6"><bdi class="secno">9.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-6"><bdi class="secno">9.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#children-changed-callback"><bdi class="secno">10. </bdi>Children changed callback</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-7"><bdi class="secno">10.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-7"><bdi class="secno">10.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#open-styling-of-shadow-roots"><bdi class="secno">11. </bdi>Open styling of shadow roots</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-8"><bdi class="secno">11.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-8"><bdi class="secno">11.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#declarative-custom-elements"><bdi class="secno">12. </bdi>Declarative custom elements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-9"><bdi class="secno">12.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-9"><bdi class="secno">12.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#feature-or-problem"><bdi class="secno">13. </bdi>Feature or Problem</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#description-10"><bdi class="secno">13.1 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#motivation-10"><bdi class="secno">13.2 </bdi>Motivation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">14. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#index"><bdi class="secno">A. </bdi>Index</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#index-defined-here"><bdi class="secno">A.1 </bdi>Terms defined by this specification</a></li><li class="tocline"><a class="tocxref" href="#index-defined-elsewhere"><bdi class="secno">A.2 </bdi>Terms defined by reference</a></li></ol></li></ol></nav>
    <section class="informative" id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div><p><em>This section is non-normative.</em></p>
      
      <p>The initial slate of APIs that browsers shipped with web components "v1" left many important features and use-cases on a future to-do list, to be finalized out after the core custom element and shadow DOM features landed. While the web components GitHub issues and face-to-face meets have tracked and discussed many of these features individually, there hasn't been a comprehensive overview of what's left to "finish" web components.</p>
      <p>This document tries to highlight the main features that are lacking from the web components spec that either block adoption for more developers and frameworks, or cause pain points for existing developers.</p>
      <p>It's worth noting that many of these pain points are directly related to Shadow DOM's encapsulation. While there are many benefits to some types of widely shared components to strong encapsulation, the friction of strong encapsulation has prevented most developers from adopting Shadow DOM, to the point of there being alternate proposals for style scoping that don't use Shadow DOM. We urge browser vendors to recognize these barriers and work to make Shadow DOM more usable by more developers.</p>
      <table>
        <thead>
          <tr>
            <th>Feature or Problem</th>
            <th>GitHub Issue(s)</th>
            <th>Priority</th>
            <th>Status(?)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th><a href="#form-associated-custom-elements">Form-Associated Custom Elements</a></th>
            <td><a href="https://github.com/WICG/webcomponents/issues/187">WICG/webcomponents#187</a></td>
            <td>Critical</td>
            <td>Some implementation</td>
          </tr>
          <tr>
            <th><a href="#cross-root-aria">Cross-root ARIA</a></th>
            <td>
              <a href="https://github.com/WICG/aom/issues/169">WICG/aom#169</a><br>
              <a href="https://github.com/WICG/aom/issues/107">WICG/aom#107</a><br>
              <a href="https://github.com/WICG/webcomponents/issues/917">WICG/webcomponents#917</a><br>
              <a href="https://github.com/WICG/webcomponents/issues/916">WICG/webcomponents#916</a>
            </td>
            <td>Critical</td>
            <td>Uncertain</td>
          </tr>
          <tr>
            <th><a href="http://localhost:8080/status.html#constructable-stylesheets-adoptedstylesheets">Constructable Stylesheets &amp; adoptedStyleSheets</a></th>
            <td><a href="https://github.com/WICG/webcomponents/issues/169">WICG/webcomponents#468</a></td>
            <td>Critical</td>
            <td>Some implementation</td>
          </tr>
          <tr>
            <th><a href="#css-module-scripts">CSS Module Scripts</a></th>
            <td><a href="https://github.com/WICG/webcomponents/issues/759">WICG/webcomponents#759</a></td>
            <td>Critical</td>
            <td>Some implementation</td>
          </tr>
          <tr>
            <th><a href="#scoped-element-registries">Scoped Element Registries</a></th>
            <td><a href="https://github.com/WICG/webcomponents/issues/716">WICG/webcomponents#716</a></td>
            <td>Critical</td>
            <td>Consensus</td>
          </tr>
          <tr>
            <th><a href="#declarative-shadow-dom">Declarative Shadow DOM</a></th>
            <td><a href="https://github.com/whatwg/dom/issues/831">whatwg/dom#831</a></td>
            <td>Critical</td>
            <td>Partial consensus, some implementation</td>
          </tr>
          <tr>
            <th><a href="#composed-selection">Composed Selection</a></th>
            <td><a href="https://github.com/WICG/webcomponents/issues/79">WICG/webcomponents#79</a></td>
            <td>High</td>
            <td>Partial consensus, divergent partial implementations</td>
          </tr>
          <tr>
            <th>Declarative CSS Modules</th>
            <td><a href="https://github.com/WICG/webcomponents/issues/939">WICG/webcomponents#939</a></td>
            <td>High</td>
            <td>Not Addressed</td>
          </tr>
          <tr>
            <th><a href="#children-changed-callback">Children changed callback</a></th>
            <td><a href="https://github.com/WICG/webcomponents/issues/809">WICG/webcomponents#809</a></td>
            <td>High</td>
            <td>---</td>
          </tr>
          <tr>
            <th><a href="#open-styling-of-shadow-roots">Open styling of shadow roots</a></th>
            <td><a href="https://github.com/WICG/webcomponents/issues/909">WICG/webcomponents#909</a></td>
            <td>High</td>
            <td>Not addressed</td>
          </tr>
          <tr>
            <th><a href="#declarative-custom-elements">Declarative custom elements</a></th>
            <td><a href="https://github.com/WICG/webcomponents/blob/gh-pages/proposals/Declarative-Custom-Elements-Strawman.md">Strawperson</a></td>
            <td>High</td>
            <td>Not addressed</td>
          </tr>
          <tr>
            <th>---</th>
            <td>---</td>
            <td>---</td>
            <td>---</td>
          </tr>
        </tbody>
      </table>
    </section>
     <section id="form-associated-custom-elements"><div class="header-wrapper"><h2 id="x2-form-associated-custom-elements"><bdi class="secno">2. </bdi>Form-Associated Custom Elements</h2><a class="self-link" href="#form-associated-custom-elements" aria-label="Permalink for Section 2."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/187">WICG/webcomponents#187</a></dd>
        <dt>Priority:</dt>
        <dd>Critical</dd>
        <dt>Status:</dt>
        <dd>Some implementation</dd>
        <dd>Mozilla: <a href="https://mozilla.github.io/standards-positions/#form-participation-api" target="_blank">position</a></dd>
      </dl>
      <section id="description"><div class="header-wrapper"><h3 id="x2-1-description"><bdi class="secno">2.1 </bdi>Description</h3><a class="self-link" href="#description" aria-label="Permalink for Section 2.1"></a></div>
        
        <p>Form-associated custom elements allow custom elements to participate in forms to the same degree as native elements, including integrations with the form’s validation, state, and submission as well as exposing the Accessibility Object Model to the element.</p>
        <p>A sample use case can be found in <a href="https://css-tricks.com/creating-custom-form-controls-with-elementinternals/">this article by Caleb Williams</a>.</p>
      </section>
      <section id="motivation"><div class="header-wrapper"><h3 id="x2-2-motivation"><bdi class="secno">2.2 </bdi>Motivation</h3><a class="self-link" href="#motivation" aria-label="Permalink for Section 2.2"></a></div>
        
        <p>One of the most common use cases for web components is creating form controls not available natively. Some examples include switches and credit card inputs.</p>
        <p>There is no way for forms to fully integrate with form elements located in a different shadow root the same way they would with form elements in the same root. The only options available to achieve a similar result are:</p>
        <ul>
          <li>The formdata event: this event only provides integration on form submission. Using this feature alone may also lead to accessibility issues due to the lack of cross-root ARIA.</li>
          <li>
            Setting a form element in light DOM (e.g. using slots): this gives web components authors two main options both of which will only work with standard form elements, mostly for form submission, and require both implementers and end users to write more code:
            <ul>
              <li>Visually hide the form element in light DOM and synchronize its value to a visible form element located inside the web component’s shadow root.</li>
              <li>Have both the form element and its label located in slots and forgo the granular control shadow DOM gives you over how to allow for CSS customization.</li>
            </ul>
          </li>
        </ul>
        <p>This situation has forced developers to either not use web components for form elements or create their own form systems that allow for full integration (e.g. many big web component libraries such as Lion or Shoelace provide form systems that integrate with their components). This limits the reach web components could have as plug-in form elements for projects created with different tech stacks.</p>
      </section>
    </section>
    <section id="cross-root-aria"><div class="header-wrapper"><h2 id="x3-cross-root-aria"><bdi class="secno">3. </bdi>Cross-root ARIA</h2><a class="self-link" href="#cross-root-aria" aria-label="Permalink for Section 3."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/aom/issues/169">WICG/aom#169</a></dd>
        <dd><a href="https://github.com/WICG/aom/issues/107">WICG/aom#107</a></dd>
        <dd><a href="https://github.com/WICG/webcomponents/issues/917">WICG/webcomponents#917</a></dd>
        <dd><a href="https://github.com/WICG/webcomponents/issues/916">WICG/webcomponents#916</a></dd>
        <dt>Priority:</dt>
        <dd>Critical</dd>
        <dt>Status:</dt>
        <dd>Uncertain</dd>
      </dl>
      <section id="description-0"><div class="header-wrapper"><h3 id="x3-1-description"><bdi class="secno">3.1 </bdi>Description</h3><a class="self-link" href="#description-0" aria-label="Permalink for Section 3.1"></a></div>
        
        <ol>
          <li>Shadow root encapsulation currently prevents references between elements in different roots. Cross-root ARIA references would re-enable this platform feature within shadow roots.</li>
          <li>It's not possible to "forward" ARIA attributes from a custom element host into elements in the host's shadow root. For instance, a custom input that wants to allow users to customize the ARIA role, has no way to forward the role attribute to the encapsulated native input.</li>
        </ol>
      </section>
      <section id="motivation-0"><div class="header-wrapper"><h3 id="x3-2-motivation"><bdi class="secno">3.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-0" aria-label="Permalink for Section 3.2"></a></div>
        
        <p>It's critically important that content on the web be accessible. Making web component content accessible currently requires many complicated and only partially-successful workarounds, such as:</p>
        <ul>
          <li>Observing and moving ARIA-related attributes across elements (for role, etc.)</li>
          <li>Using non-standard attributes for ARIA features, in order to apply them to elements in a shadow root.</li>
          <li>Requiring that custom elements users wrap/slot elements so that ARIA attributes can be placed directly on them. This gets very complicated as the number of slotted inputs and levels of shadow root nesting increase.</li>
          <li>Duplicating nodes across shadow root boundaries</li>
          <li>Abandoning Shadow DOM</li>
        </ul>
      </section>
    </section>
    <section id="constructable-stylesheets-adoptedstylesheets"><div class="header-wrapper"><h2 id="x4-constructable-stylesheets-adoptedstylesheets"><bdi class="secno">4. </bdi>Constructable Stylesheets &amp; adoptedStyleSheets</h2><a class="self-link" href="#constructable-stylesheets-adoptedstylesheets" aria-label="Permalink for Section 4."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/468">WICG/webcomponents#468</a></dd>
        <dt>Priority:</dt>
        <dd>Critical</dd>
        <dt>Status:</dt>
        <dd>Some implementation</dd>
        <dd>Mozilla: <a href="https://mozilla.github.io/standards-positions/#construct-stylesheets" target="_blank">position</a></dd>
      </dl>
      <section id="description-1"><div class="header-wrapper"><h3 id="x4-1-description"><bdi class="secno">4.1 </bdi>Description</h3><a class="self-link" href="#description-1" aria-label="Permalink for Section 4.1"></a></div>
        
        <p>Constructable Stylesheets and <code>adoptedStyleSheets</code> enable adding styles directly to shadow roots without creating new DOM elements. Because a single stylesheet object can be adopted by multiple scopes, it also allows sharing of styles that can be centrally modified.</p>
      </section>
      <section id="motivation-1"><div class="header-wrapper"><h3 id="x4-2-motivation"><bdi class="secno">4.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-1" aria-label="Permalink for Section 4.2"></a></div>
        
        <ul>
          <li>There is no effective way to share styles across components while allowing them to be centrally modified.</li>
          <li>Creating <code>&lt;style&gt;</code> elements for each style used in each shadow root has a measurable performance overhead.</li>
          <li>CSS Module Scripts, another critical feature, depends on constructible stylesheets.</li>
        </ul>
      </section>
    </section>
    <section id="css-module-scripts"><div class="header-wrapper"><h2 id="x5-css-module-scripts"><bdi class="secno">5. </bdi>CSS Module Scripts</h2><a class="self-link" href="#css-module-scripts" aria-label="Permalink for Section 5."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/759">WICG/webcomponents#759</a></dd>
        <dt>Priority:</dt>
        <dd>Critical</dd>
        <dt>Status:</dt>
        <dd>Some implementation</dd>
        <dd>Mozilla: <a href="https://mozilla.github.io/standards-positions/#import-attributes" target="_blank">position</a></dd>
      </dl>
      <section id="description-2"><div class="header-wrapper"><h3 id="x5-1-description"><bdi class="secno">5.1 </bdi>Description</h3><a class="self-link" href="#description-2" aria-label="Permalink for Section 5.1"></a></div>
        
        <p>CSS Module Scripts allow JavaScript modules to import style sheets. They can then be applied to a document or shadow root using adoptedStyleSheets in the same way as constructible style sheets.</p>
        <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-keyword">import</span> styleSheet <span class="hljs-keyword">from</span> <span class="hljs-string">"./styles.css"</span> assert { <span class="hljs-attr">type</span>: <span class="hljs-string">"css"</span> };
<span class="hljs-built_in">document</span>.adoptedStyleSheets = [ styleSheet ];</code></pre>
      </section>
      <section id="motivation-2"><div class="header-wrapper"><h3 id="x5-2-motivation"><bdi class="secno">5.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-2" aria-label="Permalink for Section 5.2"></a></div>
        
        <ul>
          <li>CSS modules will allow styles to be loaded in component definitions without adding <code>&lt;style&gt;</code> or <code>&lt;link&gt;</code> elements that need to be created in each element instance.</li>
          <li>Authors today often use inlined CSS strings in JS modules, but many of them want to move the CSS into separate .css files.</li>
          <li>Without CSS-in-JS it's difficult to ensure that CSS is loaded before the component is defined and rendered. CSS module scripts provide the same ordering guarantee.</li>
          <li>Component authors may need to import a resource that is only available as an external .css file, and don't have control over the resource to wrap it in a JS module.</li>
        </ul>
        <p>For further motivational details, see this explainer document: <a href="https://github.com/WICG/webcomponents/blob/gh-pages/proposals/css-modules-v1-explainer.md#why-are-css-modules-needed">webcomponents/css-modules-v1-explainer.md at gh-pages · WICG/webcomponents</a>.</p>
      </section>
    </section>
    <section id="scoped-element-registries"><div class="header-wrapper"><h2 id="x6-scoped-element-registries"><bdi class="secno">6. </bdi>Scoped Element Registries</h2><a class="self-link" href="#scoped-element-registries" aria-label="Permalink for Section 6."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/716">WICG/webcomponents#716</a></dd>
        <dt>Priority:</dt>
        <dd>Critical</dd>
        <dt>Status:</dt>
        <dd>Consensus</dd>
      </dl>
      <section id="description-3"><div class="header-wrapper"><h3 id="x6-1-description"><bdi class="secno">6.1 </bdi>Description</h3><a class="self-link" href="#description-3" aria-label="Permalink for Section 6.1"></a></div>
        
        <p>Scoped element registries allow custom element definitions to be scoped to one or more shadow roots. This allows the same tag name to be used with different implementations in different parts of the page, greatly reducing tag name collisions.</p>
      </section>
      <section id="motivation-3"><div class="header-wrapper"><h3 id="x6-2-motivation"><bdi class="secno">6.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-3" aria-label="Permalink for Section 6.2"></a></div>
        
        <p>There are a number of situations where multiple definitions of an element may be loaded into a page, leading to errors when the second definition executes:</p>
        <ul>
          <li>Unrelated name collisions: Unrelated web component libraries may attempt to register the same name; eg, <code>&lt;my-button&gt;</code>.</li>
          <li>Versioning: Often different versions of a library are required as dependencies of an application. If any library defines a custom element, only one version of that element can be registered. This can cause bugs with incompatible versions of the element being used.</li>
          <li>Distribution: Some elements are distributed via different channels, like CDNs and NPM. If a page consumes the library from multiple sources, that can lead to name collisions. The workarounds are not obvious.</li>
          <li>Encapsulation: Some components define and use other elements as internal implementation helpers. These elements should not have to be defined in a public global scope.</li>
        </ul>
        <p>A partial polyfill for scoped custom element registries is available, but it has a number of drawbacks, including lower performance, and a requirement that all definitions have the same set of observed attributes.</p>
      </section>
    </section>
    <section id="declarative-shadow-dom"><div class="header-wrapper"><h2 id="x7-declarative-shadow-dom"><bdi class="secno">7. </bdi>Declarative Shadow DOM</h2><a class="self-link" href="#declarative-shadow-dom" aria-label="Permalink for Section 7."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/whatwg/dom/issues/831">whatwg/dom#831</a></dd>
        <dt>Priority:</dt>
        <dd>Critical</dd>
        <dt>Status:</dt>
        <dd>Partial consensus, some implementation</dd>
        <dd>Mozilla: <a href="https://mozilla.github.io/standards-positions/#declarative-shadow-dom" target="_blank">position</a></dd>
      </dl>
      <section id="description-4"><div class="header-wrapper"><h3 id="x7-1-description"><bdi class="secno">7.1 </bdi>Description</h3><a class="self-link" href="#description-4" aria-label="Permalink for Section 7.1"></a></div>
        
        <p>Declarative Shadow DOM is a mechanism to express <a href="https://www.w3.org/TR/shadow-dom/">Shadow DOM</a> using only HTML, with no dependency on JavaScript, much like light DOM can be declaratively expressed today.</p>
        <p><em>For details, see <a href="https://web.dev/declarative-shadow-dom/">this article</a> by Jason Miller and Mason Freed.</em></p>
      </section>
      <section id="motivation-4"><div class="header-wrapper"><h3 id="x7-2-motivation"><bdi class="secno">7.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-4" aria-label="Permalink for Section 7.2"></a></div>
        
        <p>Without Declarative Shadow DOM, web components depend on rendering environments that support JavaScript. This limits their use in:</p>
        <ul>
          <li>Server-Side Rendering: Without Declarative Shadow DOM, servers cannot deliver complete websites that include web component content. Markup cannot be efficiently delivered and then hydrated with JavaScript client-side.</li>
          <li>JavaScript-less environments: Many web components could be implemented without JavaScript, taking advantage of encapsulated DOM and styles. However, web components cannot currently be rendered by users who have JavaScript disabled. Developers who are more comfortable with markup than with scripting may avoid shadow DOM altogether due to its tight coupling with JavaScript.</li>
        </ul>
        <p>Chrome has <a href="https://web.dev/declarative-shadow-dom/#detection-support">experimental support</a> and <a href="https://web.dev/declarative-shadow-dom/#polyfill">a polyfill</a> for Declarative Shadow DOM, but complete workarounds are not possible since Declarative Shadow DOM is a browser-level feature. Frameworks and libraries have hacked around this issue by prerendering sites, pages, or components in JavaScript-supporting environments prior to delivering HTML.</p>
      </section>
    </section>
    <section id="composed-selection"><div class="header-wrapper"><h2 id="x8-composed-selection"><bdi class="secno">8. </bdi>Composed Selection</h2><a class="self-link" href="#composed-selection" aria-label="Permalink for Section 8."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/79">WICG/webcomponents#79</a></dd>
        <dt>Priority:</dt>
        <dd>High</dd>
        <dt>Status:</dt>
        <dd>Partial consensus, divergent partial implementations</dd>
      </dl>
      <section id="description-5"><div class="header-wrapper"><h3 id="x8-1-description"><bdi class="secno">8.1 </bdi>Description</h3><a class="self-link" href="#description-5" aria-label="Permalink for Section 8.1"></a></div>
        
        <p>The ability to get a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection">Selection</a> from <code>shadowRoot.getSelection()</code> or <code>document.getSelection()</code>, then subsequently identify the selection range across composed trees of light and/or shadow DOM.</p>
        <p>TPAC 18 resolved in <a href="https://github.com/WICG/webcomponents/issues/79#issuecomment-432974389">consensus</a> to add <code>getComposedRange()</code> to the existing Selection object (<a href="https://github.com/mfreed7/shadow-dom-selection#readme">explainer</a>). However, <code>Selection.getComposedRange()</code> is not yet implemented in any browser. Browsers also diverge in their implementations of <code>shadowRoot.getSelection</code>:</p>
        <ul>
          <li>Chrome always sets <code>isCollapsed</code> to true.</li>
          <li>Firefox has not implemented <code>shadowRoot.getSelection</code>, but returns shadow root anchorNodes from <code>document.getSelection</code>. This bug can be leveraged to <a href="https://github.com/GoogleChromeLabs/shadow-selection-polyfill">polyfill</a> <code>shadowRoot.getSelection</code>.</li>
          <li>Safari does not implement <code>shadowRoot.getSelection</code> and cannot be polyfilled.</li>
        </ul>
      </section>
      <section id="motivation-5"><div class="header-wrapper"><h3 id="x8-2-motivation"><bdi class="secno">8.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-5" aria-label="Permalink for Section 8.2"></a></div>
        
        <p>Selection does not work consistently, or at all, across or within shadow roots. <strong>This makes fully-featured rich-text editors impossible to implement via web components.</strong> Some of the web’s most popular editors have issues that are blocked on this functionality:</p>
        <ul>
          <li><a href="https://github.com/tinymce/tinymce/pull/4737#issuecomment-719317085">TinyMCE</a></li>
          <li><a href="https://github.com/ckeditor/ckeditor5/pull/7846#issuecomment-675477977">CKEditor</a></li>
          <li><a href="https://github.com/quilljs/quill/pull/1805">Quill</a></li>
        </ul>
      </section>
    </section>
    <section id="declarative-css-modules"><div class="header-wrapper"><h2 id="x9-declarative-css-modules"><bdi class="secno">9. </bdi>Declarative CSS Modules</h2><a class="self-link" href="#declarative-css-modules" aria-label="Permalink for Section 9."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/939">WICG/webcomponents#939</a></dd>
        <dt>Priority:</dt>
        <dd>High</dd>
        <dt>Status:</dt>
        <dd>Not Addressed</dd>
      </dl>
      <section id="description-6"><div class="header-wrapper"><h3 id="x9-1-description"><bdi class="secno">9.1 </bdi>Description</h3><a class="self-link" href="#description-6" aria-label="Permalink for Section 9.1"></a></div>
        
        <p>Declarative shadow roots and constructible stylesheets need to be made to work together so that stylesheets added to shadow roots can be round-tripped through HTML serialization and deserialization.</p>
      </section>
      <section id="motivation-6"><div class="header-wrapper"><h3 id="x9-2-motivation"><bdi class="secno">9.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-6" aria-label="Permalink for Section 9.2"></a></div>
        
        <p>Currently, there is no way to associate a declarative shadow root with a constructed stylesheet. This means that when a custom element with a shadow root and adopted stylesheets is serialized to HTML, it either loses its styling or some additional code has to convert the adopted stylesheets to style tags and insert them into the markup.</p>
      </section>
    </section>
    <section id="children-changed-callback"><div class="header-wrapper"><h2 id="x10-children-changed-callback"><bdi class="secno">10. </bdi>Children changed callback</h2><a class="self-link" href="#children-changed-callback" aria-label="Permalink for Section 10."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/809">WICG/webcomponents#809</a></dd>
        <dt>Priority:</dt>
        <dd>High</dd>
        <dt>Status:</dt>
        <dd>---</dd>
      </dl>
      <section id="description-7"><div class="header-wrapper"><h3 id="x10-1-description"><bdi class="secno">10.1 </bdi>Description</h3><a class="self-link" href="#description-7" aria-label="Permalink for Section 10.1"></a></div>
        
        <p>This is a proposal to add a new callback to the CEReaction extended attribute that would fire once an element's child has changed. This new callback would allow developers to deterministically know when child elements are added or removed, taking into account slotting.</p>
      </section>
      <section id="motivation-7"><div class="header-wrapper"><h3 id="x10-2-motivation"><bdi class="secno">10.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-7" aria-label="Permalink for Section 10.2"></a></div>
        
        <ul>
          <li>Simplicity: Currently, developers are using a combination of mutation observers and slotchange events to be notified when new elements have entered or removed from its scope. This would be replaced by a single callback function on the parent element.</li>
          <li>Children upgraded: When new children enter the parents scope there is no way of deterministically knowing that the child element has been upgraded with its custom element definition. Developers resort to polling, promise callbacks or timeouts to then wait for the child to finish upgrading before calling its APIs. The proposed callback would contain elements that have already been upgraded.</li>
        </ul>
      </section>
    </section>
    <section id="open-styling-of-shadow-roots"><div class="header-wrapper"><h2 id="x11-open-styling-of-shadow-roots"><bdi class="secno">11. </bdi>Open styling of shadow roots</h2><a class="self-link" href="#open-styling-of-shadow-roots" aria-label="Permalink for Section 11."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/issues/909">WICG/webcomponents#909</a></dd>
        <dt>Priority:</dt>
        <dd>High</dd>
        <dt>Status:</dt>
        <dd>Not addressed</dd>
      </dl>
      <section id="description-8"><div class="header-wrapper"><h3 id="x11-1-description"><bdi class="secno">11.1 </bdi>Description</h3><a class="self-link" href="#description-8" aria-label="Permalink for Section 11.1"></a></div>
        
        <p>Open-styleable shadow roots would be a new mode on shadow roots that allow selectors from the shadow root's containing scope. This will allow component's internal DOM to be styled by page styles if there is a chain of open-styleable shadow roots up to the document scope - which in turn allow those components to be made to be compatible with existing pages so that projects can incrementally adopt shadow DOM.</p>
      </section>
      <section id="motivation-8"><div class="header-wrapper"><h3 id="x11-2-motivation"><bdi class="secno">11.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-8" aria-label="Permalink for Section 11.2"></a></div>
        
        <p>Many potential consumers and providers of web components have raised the issue that they need to make components styleable with existing, and potentially <em>unknown</em> stylesheets. This is a common occurrence with systems like Bootstrap, Tailwind, or corporate stylesheets. The stylesheet may be loaded at the page level and maintained and distributed by a different team than the team building components. This scenario is extremely common for projects that are trying to port existing components to web components.</p>
        <p>A common request for a solution to this problem is to be able to opt shadow roots into including styles from the scope above them. A chain of these "open-styleable" shadow roots from the top-level down would allow page styles to select against nodes in the shadow root.</p>
        <p>While this does loosen encapsulation a lot, it also preserves many of the benefits of shadow DOM including upper bound style encapsulation, lower bound encapsulation to non-open-styleable shadow roots, DOM composition with slotting, and providing a scope for custom element registrations, ARIA/focus delegation, event composition, attaching constructible stylesheets and more.</p>
        <p>We estimate this is a extremely large blocker to shadow DOM adoption. The inability to style shadow roots is one of the most common complaints on various GitHub/Twitter/Chat comments.</p>
        <p>There is theoretically a workaround where a component reads styles from its containing scope and copies them into its own shadow root. This is difficult to make reactive to changes in DOM structure and new styles being added in parent scopes, and requires script so doesn't work with declarative shadow DOM.</p>
      </section>
    </section>
    <section id="declarative-custom-elements"><div class="header-wrapper"><h2 id="x12-declarative-custom-elements"><bdi class="secno">12. </bdi>Declarative custom elements</h2><a class="self-link" href="#declarative-custom-elements" aria-label="Permalink for Section 12."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd><a href="https://github.com/WICG/webcomponents/blob/gh-pages/proposals/Declarative-Custom-Elements-Strawman.md">Strawperson</a></dd>
        <dt>Priority:</dt>
        <dd>High</dd>
        <dt>Status:</dt>
        <dd>Not addressed</dd>
      </dl>
      <section id="description-9"><div class="header-wrapper"><h3 id="x12-1-description"><bdi class="secno">12.1 </bdi>Description</h3><a class="self-link" href="#description-9" aria-label="Permalink for Section 12.1"></a></div>
        
        <p>ְDevelopers would like to define a custom element, it’s shadow-root, and styles from HTML, without need for JavaScript.</p>
      </section>
      <section id="motivation-9"><div class="header-wrapper"><h3 id="x12-2-motivation"><bdi class="secno">12.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-9" aria-label="Permalink for Section 12.2"></a></div>
        
        <p>This would allow them to share reusable components easily without need for extra tooling, and to load them in <code>&lt;noscript&gt;</code> contexts. Declarative Shadow DOM allows developers to emulate this using build-tools, but requires repeating the declared shadow roots for each instance.</p>
      </section>
    </section>
    <section id="feature-or-problem"><div class="header-wrapper"><h2 id="x13-feature-or-problem"><bdi class="secno">13. </bdi>Feature or Problem</h2><a class="self-link" href="#feature-or-problem" aria-label="Permalink for Section 13."></a></div>
      
      <dl>
        <dt>GitHub Issue(s):</dt>
        <dd>---</dd>
        <dt>Priority:</dt>
        <dd>---</dd>
        <dt>Status:</dt>
        <dd>---</dd>
      </dl>
      <section id="description-10"><div class="header-wrapper"><h3 id="x13-1-description"><bdi class="secno">13.1 </bdi>Description</h3><a class="self-link" href="#description-10" aria-label="Permalink for Section 13.1"></a></div>
        
        <p>---</p>
      </section>
      <section id="motivation-10"><div class="header-wrapper"><h3 id="x13-2-motivation"><bdi class="secno">13.2 </bdi>Motivation</h3><a class="self-link" href="#motivation-10" aria-label="Permalink for Section 13.2"></a></div>
        
        <p>---</p>
      </section>
    </section>
    <section id="conformance"><div class="header-wrapper"><h2 id="x14-conformance"><bdi class="secno">14. </bdi>Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for Section 14."></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p>
      <p>
        This is required for specifications that contain normative material.
      </p>
    </section>
    <section id="index" class="appendix"><div class="header-wrapper"><h2 id="a-index"><bdi class="secno">A. </bdi>Index</h2><a class="self-link" href="#index" aria-label="Permalink for Appendix A."></a></div><section id="index-defined-here"><div class="header-wrapper"><h3 id="a-1-terms-defined-by-this-specification"><bdi class="secno">A.1 </bdi>Terms defined by this specification</h3><a class="self-link" href="#index-defined-here" aria-label="Permalink for Appendix A.1"></a></div>
    
    <ul class="index">
    
  </ul>
  </section><section id="index-defined-elsewhere"><div class="header-wrapper"><h3 id="a-2-terms-defined-by-reference"><bdi class="secno">A.2 </bdi>Terms defined by reference</h3><a class="self-link" href="#index-defined-elsewhere" aria-label="Permalink for Appendix A.2"></a></div>
    
    <ul class="index">
    
  </ul>
  </section></section>
  

<p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>