<!DOCTYPE html><html lang="en" dir="ltr"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 35.1.2">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
    
<title>Web Components Community Group: 2023 Spec/API status</title>
    
    
  
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
<meta name="color-scheme" content="light">
<style>
ul.index{columns:30ch;column-gap:1.5em}
ul.index li{list-style:inherit}
ul.index li span{color:inherit;cursor:pointer;white-space:normal}
#index-defined-here ul.index li{font-size:.9rem}
ul.index code{color:inherit}
#index-defined-here .print-only{display:none}
@media print{
#index-defined-here .print-only{display:initial}
}
</style>
<meta name="description" content="The following aims to support implementors in prioritizing, finalizing, and shipping new and agreed upon specifications in accordance with what is most needed by the web component developing community.">
<style>
.hljs{--base:#fafafa;--mono-1:#383a42;--mono-2:#686b77;--mono-3:#717277;--hue-1:#0b76c5;--hue-2:#336ae3;--hue-3:#a626a4;--hue-4:#42803c;--hue-5:#ca4706;--hue-5-2:#c91243;--hue-6:#986801;--hue-6-2:#9a6a01}
@media (prefers-color-scheme:dark){
.hljs{--base:#282c34;--mono-1:#abb2bf;--mono-2:#818896;--mono-3:#5c6370;--hue-1:#56b6c2;--hue-2:#61aeee;--hue-3:#c678dd;--hue-4:#98c379;--hue-5:#e06c75;--hue-5-2:#be5046;--hue-6:#d19a66;--hue-6-2:#e6c07b}
}
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;color:var(--mono-1,#383a42);background:#fafafa;background:var(--base,#fafafa)}
.hljs-comment,.hljs-quote{color:#717277;color:var(--mono-3,#717277);font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--hue-3,#a626a4)}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;color:var(--hue-5,#ca4706);font-weight:700}
.hljs-literal{color:#0b76c5;color:var(--hue-1,#0b76c5)}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c;color:var(--hue-4,#42803c)}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01;color:var(--hue-6-2,#9a6a01)}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--hue-6,#986801)}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3;color:var(--hue-2,#336ae3)}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#222}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#222;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "CG-DRAFT",
  "latestVersion": null,
  "edDraftURI": null,
  "editors": [
    {
      "name": "Westbrook Johnson",
      "url": "https://westbrookjohnson.com"
    },
    {
      "name": "Elliott Marquez",
      "url": "https://github.com/e111077"
    },
    {
      "name": "Michael Warren",
      "url": "https://github.com/michaelwarren1106"
    }
  ],
  "github": "w3c/webcomponents-cg",
  "shortName": "webcomponents-cg",
  "xref": "web-platform",
  "group": "webcomponents",
  "tocIntroductory": true,
  "publishISODate": "2024-10-01T00:00:00.000Z",
  "generatedSubtitle": "Draft Community Group Report 01 October 2024"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/cg-draft"></head>
  <body class="h-entry" data-cite="HTML INFRA URL WEBIDL DOM FETCH"><div class="head">
    
    <h1 id="title" class="title">Web Components Community Group: 2023 Spec/API status</h1> 
    <p id="w3c-state">
      <a href="https://www.w3.org/standards/types#reports">Draft Community Group Report</a>
      <time class="dt-published" datetime="2024-10-01">01 October 2024</time>
    </p>
    <dl>
      
      <dt>Latest published version:</dt><dd>
              none
            </dd>
      
      
      
      
      
      <dt>Editors:</dt><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://westbrookjohnson.com">Westbrook Johnson</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/e111077">Elliott Marquez</a>
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://github.com/michaelwarren1106">Michael Warren</a>
  </dd>
      
      
      <dt>Feedback:</dt><dd>
        <a href="https://github.com/w3c/webcomponents-cg/">GitHub w3c/webcomponents-cg</a>
        (<a href="https://github.com/w3c/webcomponents-cg/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/webcomponents-cg/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/webcomponents-cg/issues/">open issues</a>)
      </dd>
      
    </dl>
    
    <p class="copyright">
          <a href="https://www.w3.org/policies/#copyright">Copyright</a>
          ©
          2024
          
          the Contributors to the Web Components Community Group: 2023 Spec/API status
          Specification, published by the
          <a href="https://www.w3.org/groups/cg/webcomponents">Web Components Community Group</a> under the
          <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable
                <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a>
                is available.
              
        </p>
    <hr title="Separator for header">
  </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
      <p>The following aims to support implementors in prioritizing, finalizing, and shipping new and agreed upon specifications in accordance with what is most needed by the web component developing community.</p>
    </section>
    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/groups/cg/webcomponents">Web Components Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
            there is a limited opt-out and other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p>
      <p>The 2023 report is currently being drafted.</p>
    <p>
    <a href="https://github.com/w3c/webcomponents-cg/issues/">GitHub Issues</a> are preferred for
          discussion of this specification.
        
    
  </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents-0">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#seeking-browser-parity"><bdi class="secno">1.1 </bdi>Seeking Browser Parity</a></li><li class="tocline"><a class="tocxref" href="#seeking-initial-prototyping"><bdi class="secno">1.2 </bdi>Seeking Initial Prototyping</a></li><li class="tocline"><a class="tocxref" href="#seeking-specification-concensus"><bdi class="secno">1.3 </bdi>Seeking specification concensus</a></li><li class="tocline"><a class="tocxref" href="#table-of-contents"><bdi class="secno">1.4 </bdi>Table of Contents</a></li></ol></li><li class="tocline"><a class="tocxref" href="#cross-root-aria"><bdi class="secno">2. </bdi>Cross-root ARIA</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#links"><bdi class="secno">2.1 </bdi>Links</a></li><li class="tocline"><a class="tocxref" href="#description"><bdi class="secno">2.2 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#status"><bdi class="secno">2.3 </bdi>Status</a></li><li class="tocline"><a class="tocxref" href="#key-scenarios"><bdi class="secno">2.4 </bdi>Key Scenarios</a></li><li class="tocline"><a class="tocxref" href="#initial-api-summary-quick-api-proposal"><bdi class="secno">2.5 </bdi>Initial API Summary/Quick API Proposal</a></li><li class="tocline"><a class="tocxref" href="#related-specs"><bdi class="secno">2.6 </bdi>Related Specs</a></li><li class="tocline"><a class="tocxref" href="#open-questions"><bdi class="secno">2.7 </bdi>Open Questions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#css-slot-content-detection"><bdi class="secno">3. </bdi>CSS Slot Content Detection</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#links-0"><bdi class="secno">3.1 </bdi>Links</a></li><li class="tocline"><a class="tocxref" href="#description-0"><bdi class="secno">3.2 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#status-0"><bdi class="secno">3.3 </bdi>Status</a></li><li class="tocline"><a class="tocxref" href="#initial-api-summary-quick-api-proposal-0"><bdi class="secno">3.4 </bdi>Initial API Summary/Quick API Proposal</a></li><li class="tocline"><a class="tocxref" href="#key-scenarios-0"><bdi class="secno">3.5 </bdi>Key Scenarios</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#use-case-example"><bdi class="secno">3.5.1 </bdi>Use Case Example</a></li></ol></li><li class="tocline"><a class="tocxref" href="#concerns"><bdi class="secno">3.6 </bdi>Concerns</a></li><li class="tocline"><a class="tocxref" href="#dissenting-opinion"><bdi class="secno">3.7 </bdi>Dissenting Opinion</a></li><li class="tocline"><a class="tocxref" href="#related-specs-0"><bdi class="secno">3.8 </bdi>Related Specs</a></li><li class="tocline"><a class="tocxref" href="#open-questions-0"><bdi class="secno">3.9 </bdi>Open Questions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#declarative-shadow-dom"><bdi class="secno">4. </bdi>Declarative Shadow DOM</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#links-1"><bdi class="secno">4.1 </bdi>Links</a></li><li class="tocline"><a class="tocxref" href="#description-1"><bdi class="secno">4.2 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#status-1"><bdi class="secno">4.3 </bdi>Status</a></li><li class="tocline"><a class="tocxref" href="#initial-api-summary-quick-api-proposal-1"><bdi class="secno">4.4 </bdi>Initial API Summary/Quick API Proposal</a></li><li class="tocline"><a class="tocxref" href="#key-scenarios-1"><bdi class="secno">4.5 </bdi>Key Scenarios</a></li><li class="tocline"><a class="tocxref" href="#concerns-0"><bdi class="secno">4.6 </bdi>Concerns</a></li><li class="tocline"><a class="tocxref" href="#dissenting-opinion-0"><bdi class="secno">4.7 </bdi>Dissenting Opinion</a></li><li class="tocline"><a class="tocxref" href="#related-specs-1"><bdi class="secno">4.8 </bdi>Related Specs</a></li><li class="tocline"><a class="tocxref" href="#open-questions-1"><bdi class="secno">4.9 </bdi>Open Questions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#scoped-element-registries"><bdi class="secno">5. </bdi>Scoped Element Registries</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#links-2"><bdi class="secno">5.1 </bdi>Links</a></li><li class="tocline"><a class="tocxref" href="#description-2"><bdi class="secno">5.2 </bdi>Description</a></li><li class="tocline"><a class="tocxref" href="#status-2"><bdi class="secno">5.3 </bdi>Status</a></li><li class="tocline"><a class="tocxref" href="#initial-api-summary-quick-api-proposal-2"><bdi class="secno">5.4 </bdi>Initial API Summary/Quick API Proposal</a></li><li class="tocline"><a class="tocxref" href="#key-scenarios-2"><bdi class="secno">5.5 </bdi>Key Scenarios</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#design-system-use-case"><bdi class="secno">5.5.1 </bdi>Design system use case</a></li><li class="tocline"><a class="tocxref" href="#micro-front-end-use-case"><bdi class="secno">5.5.2 </bdi>Micro-front end use case</a></li></ol></li><li class="tocline"><a class="tocxref" href="#polyfills"><bdi class="secno">5.6 </bdi>Polyfills</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#mixin"><bdi class="secno">5.6.1 </bdi>Mixin</a></li></ol></li><li class="tocline"><a class="tocxref" href="#concerns-1"><bdi class="secno">5.7 </bdi>Concerns</a></li><li class="tocline"><a class="tocxref" href="#dissenting-opinion-1"><bdi class="secno">5.8 </bdi>Dissenting Opinion</a></li><li class="tocline"><a class="tocxref" href="#related-specs-2"><bdi class="secno">5.9 </bdi>Related Specs</a></li><li class="tocline"><a class="tocxref" href="#open-questions-2"><bdi class="secno">5.10 </bdi>Open Questions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">6. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#index"><bdi class="secno">A. </bdi>Index</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#index-defined-here"><bdi class="secno">A.1 </bdi>Terms defined by this specification</a></li><li class="tocline"><a class="tocxref" href="#index-defined-elsewhere"><bdi class="secno">A.2 </bdi>Terms defined by reference</a></li></ol></li></ol></nav>
    <section class="informative" id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div><p><em>This section is non-normative.</em></p>
      
      <p>Web component features in the platform swing broadly from twinkle in someone's eye to just waiting for that last browser vendor to ship in the wild. Along that spectrum, there are a myriad of features that browser implementors and web developers could focus on and it's difficult to always align on which are most important. We, the Web Components Community Group, look to build on our work from <a href="./2021.html">2021</a> and <a href="./2022.html">2022</a> and continue to shed light on the priorities in this space as seen by developers conuming these features.</p>
      <p>Taking the feedback from previous years to heart, we are drew out four features of the highest priority. Each are at different places on the spectrum of "ready to consume", and we look forward to working more closely with vendors in making progress towards that goal. The four features are listed below by status:</p>
      <section id="seeking-browser-parity"><div class="header-wrapper"><h3 id="x1-1-seeking-browser-parity"><bdi class="secno">1.1 </bdi>Seeking Browser Parity</h3><a class="self-link" href="#seeking-browser-parity" aria-label="Permalink for Section 1.1"></a></div>
        
        <p>We noticed the following specs already have a high degree of alignment from an implementation perspective, but support in browsers is still not equally distributed.  Filling in these gaps would be a big win for users and developers alike for a more predictable web.</p>
        <ul>
          <li><a href="#declarative-shadow-dom">Declarative Shadow DOM</a></li>
        </ul>
      </section>
      <section id="seeking-initial-prototyping"><div class="header-wrapper"><h3 id="x1-2-seeking-initial-prototyping"><bdi class="secno">1.2 </bdi>Seeking Initial Prototyping</h3><a class="self-link" href="#seeking-initial-prototyping" aria-label="Permalink for Section 1.2"></a></div>
        
        <p>The following specs have recieved a quality review at the proposal stage and are ready to be prototyped in browser. What sort of support could the Web Components Community Group lend to browser implementors as part of this process?</p>
        <ul>
          <li><a href="#scoped-element-registries">Scoped Registries</a></li>
        </ul>
      </section>
      <section id="seeking-specification-concensus"><div class="header-wrapper"><h3 id="x1-3-seeking-specification-concensus"><bdi class="secno">1.3 </bdi>Seeking specification concensus</h3><a class="self-link" href="#seeking-specification-concensus" aria-label="Permalink for Section 1.3"></a></div>
        
        <p>The following specs we see as highly valuable to the developer community for being able to deliver great web experiences to users when using Web Components.  As it pertains to topics like Aria and SSR, these specs just need a little more alignment across browser implementors so that consensus can be achieved.</p>
        <ul>
          <li><a href="#cross-root-aria">Cross-root Aria</a></li>
          <li><a href="#css-slot-content-detection">CSS Slot Content Detection</a></li>
        </ul>
      </section>
      <section id="table-of-contents"><div class="header-wrapper"><h3 id="x1-4-table-of-contents"><bdi class="secno">1.4 </bdi>Table of Contents</h3><a class="self-link" href="#table-of-contents" aria-label="Permalink for Section 1.4"></a></div>
        
        <table>
          <thead>
            <tr>
              <th>Feature or Problem</th>
              <th>GitHub Issue(s)</th>
              <th>Status(?)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th><a href="#cross-root-aria">Cross-root ARIA</a></th>
              <td>
                <a href="https://github.com/WICG/aom/issues/169">WICG/aom#169</a><br>
                <a href="https://github.com/WICG/aom/issues/107">WICG/aom#107</a><br>
                <a href="https://github.com/WICG/webcomponents/issues/917">WICG/webcomponents#917</a><br>
                <a href="https://github.com/WICG/webcomponents/issues/916">WICG/webcomponents#916</a>
              </td>
              <td>Uncertain</td>
            </tr>
            <tr>
              <th><a href="#declarative-shadow-dom">Declarative Shadow DOM</a></th>
              <td><a href="https://github.com/whatwg/dom/issues/831">whatwg/dom#831</a></td>
              <td>Concensus, lacking parity in implementation</td>
            </tr>
            <tr>
              <th><a href="#scoped-element-registries">Scoped Element Registries</a></th>
              <td><a href="https://github.com/WICG/webcomponents/issues/716">WICG/webcomponents#716</a></td>
              <td>Consensus, lacking initial prototype</td>
            </tr>
            <tr>
              <th><a href="#css-slot-content-detection">CSS Slot Content Detection</a></th>
              <td>
                <a href="https://github.com/w3c/csswg-drafts/issues/7922">w3c/csswg-drafts#7922</a>
                <a href="https://github.com/WICG/webcomponents/issues/936">WICG/webcomponents#936</a>
                <a href="https://github.com/w3c/csswg-drafts/issues/6867">w3c/csswg-drafts#6867</a>
              </td>
              <td>Uncertain</td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>
    <section id="cross-root-aria"><div class="header-wrapper"><h2 id="x2-cross-root-aria"><bdi class="secno">2. </bdi>Cross-root ARIA</h2><a class="self-link" href="#cross-root-aria" aria-label="Permalink for Section 2."></a></div>
      
      <section id="links"><div class="header-wrapper"><h3 id="x2-1-links"><bdi class="secno">2.1 </bdi>Links</h3><a class="self-link" href="#links" aria-label="Permalink for Section 2.1"></a></div>
        
        <dl>
          <dt>Previous WCCG Report(s)</dt>
          <dd><a href="https://w3c.github.io/webcomponents-cg/2022.html#cross-root-aria">2022</a></dd>
          <dt>GitHub issues:</dt>
          <dd><a href="https://github.com/leobalter/cross-root-aria-delegation" target="_blank">Cross-root ARIA Delegation</a></dd>
          <dd><a href="https://github.com/Westbrook/cross-root-aria-reflection" target="_blank">Cross-root ARIA Reflection</a></dd>
          <dt>Browser positions:</dt>
          <dd>---</dd>
        </dl>
      </section>
      <section id="description"><div class="header-wrapper"><h3 id="x2-2-description"><bdi class="secno">2.2 </bdi>Description</h3><a class="self-link" href="#description" aria-label="Permalink for Section 2.2"></a></div>
        
        <p>
          This problem space is expertly described by Alice Boxhall in this <a href="https://alice.pages.igalia.com/blog/how-shadow-dom-and-accessibility-are-in-conflict/" target="_blank">blog post</a>.
        </p>
        <p>
          In short, accessibility with shadow roots in broken when addressed via the patterns that web developers have come to be acustomed to in their work.
        </p>
      </section>
      <section id="status"><div class="header-wrapper"><h3 id="x2-3-status"><bdi class="secno">2.3 </bdi>Status</h3><a class="self-link" href="#status" aria-label="Permalink for Section 2.3"></a></div>
        
        <p>
          Implementors participating in bi-weekly Accessibility Object Model meetings with at the WICG have implied 
        </p>
      </section>
      <section id="key-scenarios"><div class="header-wrapper"><h3 id="x2-4-key-scenarios"><bdi class="secno">2.4 </bdi>Key Scenarios</h3><a class="self-link" href="#key-scenarios" aria-label="Permalink for Section 2.4"></a></div>
        
        <p>
          This plays out in a Combobox pattern as follows:
        </p>
        <pre><code aria-busy="false" class="hljs xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">x-label</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"x-label"</span>&gt;</span>
    #shadowRoot
    | <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">""</span>&gt;</span>Example Label<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">x-label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">x-combobox</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"x-combobox-1"</span>&gt;</span>
    #shadowRoot
    | <span class="hljs-tag">&lt;<span class="hljs-name">x-input</span>&gt;</span>
    |   #shadowRoot
    |   | <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
    |   |   <span class="hljs-attr">role</span>=<span class="hljs-string">"combobox"</span>
    |   |   <span class="hljs-attr">aria-expanded</span>=<span class="hljs-string">"true"</span>
    |   | /&gt;</span>
    | <span class="hljs-tag">&lt;/<span class="hljs-name">x-input</span>&gt;</span>
    | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"Open"</span> <span class="hljs-attr">aria-expanded</span>=<span class="hljs-string">"true"</span>&gt;</span>v<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    |
    | <span class="hljs-tag">&lt;<span class="hljs-name">x-listbox</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"x-listbox-1"</span>&gt;</span>
    |   #shadowRoot
    |   | <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"listbox"</span>&gt;</span>
    |   |   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"option"</span>&gt;</span>Option 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    |   |   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"option"</span>&gt;</span>Option 2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    |   |   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"option"</span>&gt;</span>Option 3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    |   | <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    | <span class="hljs-tag">&lt;/<span class="hljs-name">x-listbox</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">x-combobox</span>&gt;</span>
</code></pre>
        <p>Even when leveraging the available aria attributes in this case there is no way to assocaite the <code>x-label</code> to the <code>x-input</code> or either of the <code>[role="listbox"]</code> or <code>[role="option"]</code> elements to it either.</p>
        <p>Less complex patterns are similarly blocked by current APIs. Here we see a custom radio group:</p>
        <pre><code aria-busy="false" class="hljs xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radiogroup"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-button</span>&gt;</span>
      #shadowRoot
      | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radio"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-button</span>&gt;</span>
      #shadowRoot
      | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radio"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-button</span>&gt;</span>
      #shadowRoot
      | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radio"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
        <p>Due to the shadow boundary and DOM element between the <code>[role="radio"]</code> element and the <code>[role="radiogroup"]</code> ancestor, there is no way to complete the accessibility tree that is needed to provide information about this interface to screen readers.</p>
      </section>
      <section id="initial-api-summary-quick-api-proposal"><div class="header-wrapper"><h3 id="x2-5-initial-api-summary-quick-api-proposal"><bdi class="secno">2.5 </bdi>Initial API Summary/Quick API Proposal</h3><a class="self-link" href="#initial-api-summary-quick-api-proposal" aria-label="Permalink for Section 2.5"></a></div>
        
        <p>Leveraging the Element Handles API the Combobox pattern would be work out as follows:</p>
        <pre><code aria-busy="false" class="hljs xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">x-label</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"x-label"</span> <span class="hljs-attr">importhandles</span>=<span class="hljs-string">"label-for: x-combobox-1::handle(the-input)"</span>&gt;</span>
    #shadowRoot
    | <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">":host::handle(label-for)"</span>&gt;</span>Example Label<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">x-label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">x-combobox</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"x-combobox-1"</span>&gt;</span>
    #shadowRoot
    | <span class="hljs-tag">&lt;<span class="hljs-name">x-input</span> 
    |   <span class="hljs-attr">exporthandles</span>=<span class="hljs-string">"the-input"</span>
    |   <span class="hljs-attr">importhandles</span>=<span class="hljs-string">"my-activedescendant: x-listbox-1::handle(active), my-listbox: x-listbox-1::handle(the-listbox)"</span>&gt;</span>
    |   #shadowRoot
    |   | <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
    |   |   <span class="hljs-attr">role</span>=<span class="hljs-string">"combobox"</span>
    |   |   <span class="hljs-attr">handle</span>=<span class="hljs-string">"the-input"</span>
    |   |   <span class="hljs-attr">aria-controls</span>=<span class="hljs-string">":host::handle(my-listbox)"</span>
    |   |   <span class="hljs-attr">aria-activedescendant</span>=<span class="hljs-string">":host::handle(my-activedescendant)"</span>
    |   |   <span class="hljs-attr">aria-expanded</span>=<span class="hljs-string">"true"</span>
    |   | /&gt;</span>
    | <span class="hljs-tag">&lt;/<span class="hljs-name">x-input</span>&gt;</span>
    | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"Open"</span> <span class="hljs-attr">aria-expanded</span>=<span class="hljs-string">"true"</span>&gt;</span>v<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    |
    | <span class="hljs-tag">&lt;<span class="hljs-name">x-listbox</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"x-listbox-1"</span>&gt;</span>
    |   #shadowRoot
    |   | <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"listbox"</span> <span class="hljs-attr">handle</span>=<span class="hljs-string">"the-listbox"</span>&gt;</span>
    |   |   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"option"</span> <span class="hljs-attr">handle</span>=<span class="hljs-string">"opt1 active"</span>&gt;</span>Option 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    |   |   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"option"</span> <span class="hljs-attr">handle</span>=<span class="hljs-string">"opt2"</span>&gt;</span>Option 2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    |   |   <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"option"</span> <span class="hljs-attr">handle</span>=<span class="hljs-string">"opt3"</span>&gt;</span>Option 3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    |   | <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    | <span class="hljs-tag">&lt;/<span class="hljs-name">x-listbox</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">x-combobox</span>&gt;</span>
</code></pre>
        <p>Leveraging the Aria Delegate API the radio group pattern could be acheived via:</p>
        <pre><code aria-busy="false" class="hljs xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radiogroup"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-button</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radio"</span>&gt;</span>
      #shadowRoot shadowrootsemanticdelegate="button"
      | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-button</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radio"</span>&gt;</span>
      #shadowRoot shadowrootsemanticdelegate="button"
      | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x-button</span>&gt;</span>
      #shadowRoot shadowrootsemanticdelegate="button"
      | <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x-button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
      </section>
      <section id="related-specs"><div class="header-wrapper"><h3 id="x2-6-related-specs"><bdi class="secno">2.6 </bdi>Related Specs</h3><a class="self-link" href="#related-specs" aria-label="Permalink for Section 2.6"></a></div>
        
        <ul>
          <li><a href="https://github.com/WICG/aom" target="_blank">AOM</a></li>
          <li><a href="https://wicg.github.io/aom/aria-reflection-explainer.html" target="_blank">ARIA Reflection</a></li>
          <li><a href="https://github.com/WICG/aom/blob/gh-pages/element_reference_properties.md" target="_blank">Element reference DOM properties</a></li>
          <li>Import/Export IDs: <a href="https://github.com/WICG/aom/issues/169" target="_blank">Content attribute to import/export IDs across shadow boundaries WICG/aom#169</a></li>
          <li>Cross Root Delegation and Reflection: <a href="https://github.com/leobalter/cross-root-aria-delegation" target="_blank">https://github.com/leobalter/cross-root-aria-delegation</a></li>
          <li>Semantic Delegates: <a href="https://github.com/alice/aom/blob/gh-pages/semantic-delegate.md" target="_blank">https://github.com/alice/aom/blob/gh-pages/semantic-delegate.md</a></li>
          <li>Encapsulation preserving IDL references: <a href="https://github.com/WICG/aom/issues/195" target="_blank">Encapsulation-preserving IDL Element reference attributes  WICG/aom#195</a></li>
          <li>Element Handles: RFC: <a href="https://github.com/WICG/aom/pull/200" target="_blank">Element Handles for Cross-root ARIA WICG/aom#200</a></li>
          <li>and more, many striking nuanced grounds in between and around the above proposals</li>
        </ul>
      </section>
      <section id="open-questions"><div class="header-wrapper"><h3 id="x2-7-open-questions"><bdi class="secno">2.7 </bdi>Open Questions</h3><a class="self-link" href="#open-questions" aria-label="Permalink for Section 2.7"></a></div>
        
        <ul>
          <li>Which is the best way?</li>
          <li>Can <em>all</em> problems be solves with one API or is the variance of issue requiring multiple APIs?</li>
        </ul>
      </section>
    </section>

    <section id="css-slot-content-detection"><div class="header-wrapper"><h2 id="x3-css-slot-content-detection"><bdi class="secno">3. </bdi>CSS Slot Content Detection</h2><a class="self-link" href="#css-slot-content-detection" aria-label="Permalink for Section 3."></a></div>
      
      <section id="links-0"><div class="header-wrapper"><h3 id="x3-1-links"><bdi class="secno">3.1 </bdi>Links</h3><a class="self-link" href="#links-0" aria-label="Permalink for Section 3.1"></a></div>
        
        <dl>
          <dt>Previous WCCG Report(s)</dt>
          <dd>N/A</dd>
          <dt>GitHub issues:</dt>
          <dd><a href="https://github.com/w3c/csswg-drafts/issues/7922">w3c/csswg-drafts#7922</a></dd>
          <dd><a href="https://github.com/WICG/webcomponents/issues/936">WICG/webcomponents#936</a></dd>
          <dd><a href="https://github.com/w3c/csswg-drafts/issues/6867">w3c/csswg-drafts#6867</a></dd>
          <dt>Browser positions:</dt>
          <dd>---</dd>
        </dl>
      </section>
      <section id="description-0"><div class="header-wrapper"><h3 id="x3-2-description"><bdi class="secno">3.2 </bdi>Description</h3><a class="self-link" href="#description-0" aria-label="Permalink for Section 3.2"></a></div>
        
        <p>In shadow DOM, projection is the concept of placing an element into the light DOM and rendering it in a custom position via slots in the shadow DOM. This allows for greater control over the layout and styling of elements while also giving the user direct control over the contents and styling since the nodes are in the light DOM.</p>
        <p>These are the current mechanisms in which to interact with slotted content:</p>
        <ul>
          <li><code>::slotted()</code> pseudo element
            <ul>
              <li>It can take selectors and can only select directly slotted children and not their subtree.</li>
            </ul>
          </li>
          <li>
            A <code>&lt;slot&gt;</code> can also have children
            <ul>
              <li>Those children will only render if there is no slotted content assigned to that slot</li>
              <li>Content can include any Node including a whitespace text node</li>
            </ul>
          </li>
        </ul>
      </section>
      <section id="status-0"><div class="header-wrapper"><h3 id="x3-3-status"><bdi class="secno">3.3 </bdi>Status</h3><a class="self-link" href="#status-0" aria-label="Permalink for Section 3.3"></a></div>
        
        <ul>
          <li>No official or concrete browser positions.</li>
        </ul>
      </section>
      <section id="initial-api-summary-quick-api-proposal-0"><div class="header-wrapper"><h3 id="x3-4-initial-api-summary-quick-api-proposal"><bdi class="secno">3.4 </bdi>Initial API Summary/Quick API Proposal</h3><a class="self-link" href="#initial-api-summary-quick-api-proposal-0" aria-label="Permalink for Section 3.4"></a></div>
        
        <p>Summary or proposal based on current status; paragraph(s) and code.</p>
      </section>
      <section id="key-scenarios-0"><div class="header-wrapper"><h3 id="x3-5-key-scenarios"><bdi class="secno">3.5 </bdi>Key Scenarios</h3><a class="self-link" href="#key-scenarios-0" aria-label="Permalink for Section 3.5"></a></div>
        
        <p>Currently there is no CSS-only way to determine whether a <code>&lt;slot&gt;</code> has content assigned to it without requiring the consumer of a web component to explicitly state so.</p>
        <section id="use-case-example"><div class="header-wrapper"><h4 id="x3-5-1-use-case-example"><bdi class="secno">3.5.1 </bdi>Use Case Example</h4><a class="self-link" href="#use-case-example" aria-label="Permalink for Section 3.5.1"></a></div>
        <p>In the web component-based <a href="https://github.com/material-components/material-web" target="_blank">https://github.com/material-components/material-web</a>, there is the Dialog component. The dialog component can have three sections slotted in:</p>
        <ul>
          <li>slot=headline</li>
          <li>slot=content</li>
          <li>slot=actions</li>
        </ul>
        <p>When the dialog’s content is slotted, the dialog must show a divider which is rendered in its shadow DOM. In essence the <code>&lt;md-divider&gt;</code> which is a sibling to <code>&lt;slot name=”content”&gt;</code> must be styled. e.g</p>
        <pre><code aria-busy="false" class="hljs xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">md-dialog</span> <span class="hljs-attr">has-content</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">shadowrootmode</span>=<span class="hljs-string">"open"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">
        md-divider {
          <span class="hljs-attribute">display</span>: none;
        }
        <span class="hljs-selector-pseudo">:host</span>(<span class="hljs-selector-attr">[has-content]</span>) md-divider {
          <span class="hljs-attribute">display</span>: flex;
        }
      </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
      ...
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">md-divider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"before"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">md-divider</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">md-divider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"after"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">md-divider</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"content"</span>&gt;</span>
      Really long content ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">md-dialog</span>&gt;</span>
</code></pre>
        <p>The DX would be cleaner if <code>has-content</code> could be inferred by the CSS rather than the user having to apply it or JS having to run at runtime.
        </p><p><em>Using <code>/slotted/</code> for the sake of example.</em></p>
        <pre><code aria-busy="false" class="hljs xml">
  <span class="hljs-tag">&lt;<span class="hljs-name">md-dialog</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">shadowrootmode</span>=<span class="hljs-string">"open"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css">
        md-divider {
          <span class="hljs-attribute">display</span>: none;
        }
        <span class="hljs-selector-class">.content</span> md-divider<span class="hljs-selector-pseudo">:has</span>(~ slot/slotted/ *),
        <span class="hljs-selector-class">.content</span> slot<span class="hljs-selector-pseudo">:has</span>(/slotted/ *) ~ md-divider {
          <span class="hljs-attribute">display</span>: flex;
        }
      </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
      ...
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">md-divider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"before"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">md-divider</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">md-divider</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"after"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">md-divider</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"content"</span>&gt;</span>
      Really long content ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">md-dialog</span>&gt;</span>
</code></pre>
        <p>This removes the need for the user to declare that there is slotted content twice:</p>
        <ul>
          <li><code>div[slot=content]</code></li>
          <li><code>md-dialog[has-content]</code></li>
        </ul>
      </section></section>
      <section id="concerns"><div class="header-wrapper"><h3 id="x3-6-concerns"><bdi class="secno">3.6 </bdi>Concerns</h3><a class="self-link" href="#concerns" aria-label="Permalink for Section 3.6"></a></div>
        
        <ul>
          <li>---</li>
        </ul>
      </section>
      <section id="dissenting-opinion"><div class="header-wrapper"><h3 id="x3-7-dissenting-opinion"><bdi class="secno">3.7 </bdi>Dissenting Opinion</h3><a class="self-link" href="#dissenting-opinion" aria-label="Permalink for Section 3.7"></a></div>
        
        <ul>
          <li>---</li>
        </ul>
      </section>
      <section id="related-specs-0"><div class="header-wrapper"><h3 id="x3-8-related-specs"><bdi class="secno">3.8 </bdi>Related Specs</h3><a class="self-link" href="#related-specs-0" aria-label="Permalink for Section 3.8"></a></div>
        
        <ul>
          <li>---</li>
        </ul>
      </section>
      <section id="open-questions-0"><div class="header-wrapper"><h3 id="x3-9-open-questions"><bdi class="secno">3.9 </bdi>Open Questions</h3><a class="self-link" href="#open-questions-0" aria-label="Permalink for Section 3.9"></a></div>
        
        <ul>
          <li>---</li>
        </ul>
      </section>
    </section>
    <section id="declarative-shadow-dom"><div class="header-wrapper"><h2 id="x4-declarative-shadow-dom"><bdi class="secno">4. </bdi>Declarative Shadow DOM</h2><a class="self-link" href="#declarative-shadow-dom" aria-label="Permalink for Section 4."></a></div>
      
      <section id="links-1"><div class="header-wrapper"><h3 id="x4-1-links"><bdi class="secno">4.1 </bdi>Links</h3><a class="self-link" href="#links-1" aria-label="Permalink for Section 4.1"></a></div>
        
        <dl>
          <dt>Previous WCCG Report(s)</dt>
          <dd><a href="https://w3c.github.io/webcomponents-cg/2022.html#declarative-shadow-dom">2022</a></dd>
          <dt>GitHub issues:</dt>
          <dd><a href="https://github.com/whatwg/dom/issues/831">https://github.com/whatwg/dom/issues/831</a></dd>
          <dt>Browser positions:</dt>
          <dd><a href="https://chromestatus.com/feature/5191745052606464">Chrome (Shipped)</a></dd>
          <dd><a href="https://github.com/mozilla/standards-positions/issues/335">Mozilla</a></dd>
          <dd><a href="https://github.com/WebKit/standards-positions/issues/12">Safari (Shipped)</a></dd>
        </dl>
      </section>
      <section id="description-1"><div class="header-wrapper"><h3 id="x4-2-description"><bdi class="secno">4.2 </bdi>Description</h3><a class="self-link" href="#description-1" aria-label="Permalink for Section 4.2"></a></div>
        
        <p>Declarative Shadow DOM is a mechanism to express Shadow DOM using only HTML, with no dependency on JavaScript, much like light DOM can be declaratively expressed today.</p>
      </section>
      <section id="status-1"><div class="header-wrapper"><h3 id="x4-3-status"><bdi class="secno">4.3 </bdi>Status</h3><a class="self-link" href="#status-1" aria-label="Permalink for Section 4.3"></a></div>
        
        <ul>
          <li>Partial consensus, multiple implementations</li>
        </ul>
      </section>
      <section id="initial-api-summary-quick-api-proposal-1"><div class="header-wrapper"><h3 id="x4-4-initial-api-summary-quick-api-proposal"><bdi class="secno">4.4 </bdi>Initial API Summary/Quick API Proposal</h3><a class="self-link" href="#initial-api-summary-quick-api-proposal-1" aria-label="Permalink for Section 4.4"></a></div>
        
        <p>Below is an example taken from the <a href="https://web.dev/declarative-shadow-dom">web.dev blog</a> on Declarative Shadow DOM.
          </p><pre aria-busy="false"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">host-element</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">shadowroot</span>=<span class="hljs-string">"open"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Light content<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">host-element</span>&gt;</span></code></pre>
        <p></p>
      </section>
      <section id="key-scenarios-1"><div class="header-wrapper"><h3 id="x4-5-key-scenarios"><bdi class="secno">4.5 </bdi>Key Scenarios</h3><a class="self-link" href="#key-scenarios-1" aria-label="Permalink for Section 4.5"></a></div>
        
        <p>Server-Side Rendering: Without Declarative Shadow DOM, servers cannot deliver complete websites that include web component content. Markup cannot be efficiently delivered and then hydrated with JavaScript client-side.</p>
        <p>JavaScript-less environments: Many web components could be implemented without JavaScript, taking advantage of encapsulated DOM and styles. However, web components cannot currently be rendered by users who have JavaScript disabled. Developers who are more comfortable with markup than with scripting may avoid shadow DOM altogether due to its tight coupling with JavaScript..</p>
      </section>
      <section id="concerns-0"><div class="header-wrapper"><h3 id="x4-6-concerns"><bdi class="secno">4.6 </bdi>Concerns</h3><a class="self-link" href="#concerns-0" aria-label="Permalink for Section 4.6"></a></div>
        
        <ul>
          <li>Mozilla considers this to be non-harmful, though debates the merits on ROI to developers weighed against the added complexity to be added to the HTML parser from a performance perspective.</li>
        </ul>
      </section>
      <section id="dissenting-opinion-0"><div class="header-wrapper"><h3 id="x4-7-dissenting-opinion"><bdi class="secno">4.7 </bdi>Dissenting Opinion</h3><a class="self-link" href="#dissenting-opinion-0" aria-label="Permalink for Section 4.7"></a></div>
        
        <ul>
          <li>N / A</li>
        </ul>
      </section>
      <section id="related-specs-1"><div class="header-wrapper"><h3 id="x4-8-related-specs"><bdi class="secno">4.8 </bdi>Related Specs</h3><a class="self-link" href="#related-specs-1" aria-label="Permalink for Section 4.8"></a></div>
        
        <ul>
          <li><a href="https://github.com/WICG/webcomponents/issues/716">Scoped Element Registries</a></li>
        </ul>
      </section>
      <section id="open-questions-1"><div class="header-wrapper"><h3 id="x4-9-open-questions"><bdi class="secno">4.9 </bdi>Open Questions</h3><a class="self-link" href="#open-questions-1" aria-label="Permalink for Section 4.9"></a></div>
        
        <ul>
          <li>Mozilla would like to see more <a href="https://github.com/whatwg/dom/issues/831#issuecomment-988394185">real world uses cases</a> of Declarative Shadow DOM in the wild.  <a href="https://github.com/whatwg/dom/issues/831#issuecomment-1204554491" target="_blank">GitHub has confirmed that they are using DSD</a> and see many architectural benefits from it, especially for their design system. Although a polyfill exists, it comes as a bit of a catch-22 when trying to target pure SSR Web Components (HTML) use cases.</li>
        </ul>
      </section>
    </section>
    <section id="scoped-element-registries"><div class="header-wrapper"><h2 id="x5-scoped-element-registries"><bdi class="secno">5. </bdi>Scoped Element Registries</h2><a class="self-link" href="#scoped-element-registries" aria-label="Permalink for Section 5."></a></div>
      
      <section id="links-2"><div class="header-wrapper"><h3 id="x5-1-links"><bdi class="secno">5.1 </bdi>Links</h3><a class="self-link" href="#links-2" aria-label="Permalink for Section 5.1"></a></div>
        
        <dl>
          <dt>Previous WCCG Report(s)</dt>
          <dd><a href="https://w3c.github.io/webcomponents-cg/2022.html#scoped-element-registries">2022</a></dd>
          <dt>GitHub issues:</dt>
          <dd><a href="https://github.com/WICG/webcomponents/issues/716">WICG/webcomponents#716</a></dd>
          <dt>Browser positions:</dt>
          <dd>
            <ul>
              <li>
                <a href="https://github.com/WebKit/standards-positions/issues/38">WebKit</a>
              </li>
              <li>
                <a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/um-9YjJWyEQ/m/MhKN0L7FAgAJ">Chromium</a>
              </li>
              <li>
                <a href="https://github.com/mozilla/standards-positions/issues/424">Mozilla</a>
              </li>
            </ul>
          </dd>
        </dl>
      </section>
      <section id="description-2"><div class="header-wrapper"><h3 id="x5-2-description"><bdi class="secno">5.2 </bdi>Description</h3><a class="self-link" href="#description-2" aria-label="Permalink for Section 5.2"></a></div>
        
        <p>When building a custom element, the current API is the <code>customElements.define(tagName, klass)</code> which takes a custom tag name and a JS class reference and globally registers a new custom element.</p>
        <p>Scoped element registries allow custom element definitions to be scoped to one or more shadow roots. This allows the same tag name to be used with different implementations in different parts of the page, greatly reducing tag name collisions.</p>
      </section>
      <section id="status-2"><div class="header-wrapper"><h3 id="x5-3-status"><bdi class="secno">5.3 </bdi>Status</h3><a class="self-link" href="#status-2" aria-label="Permalink for Section 5.3"></a></div>
        
        <ul>
          <li>
            <p><b>Chromium</b>: Intent to Prototype / prototyping</p>
            <p><a href="https://chromestatus.com/feature/5090435261792256">Chromium Platform status Feature</a></p>
          </li>
          <li>
            <p><b>Webkit</b>: No official position yet, likely positive</p>
            <p><a href="https://github.com/WebKit/standards-positions/issues/38">Webkit standards position issue</a></p>
          </li>
          <li>
            <p><b>Mozilla</b>: No position</p>
            <p><a href="https://github.com/mozilla/standards-positions/issues/424">Mozilla standards position</a></p>
          </li>
        </ul>
      </section>
      <section id="initial-api-summary-quick-api-proposal-2"><div class="header-wrapper"><h3 id="x5-4-initial-api-summary-quick-api-proposal"><bdi class="secno">5.4 </bdi>Initial API Summary/Quick API Proposal</h3><a class="self-link" href="#initial-api-summary-quick-api-proposal-2" aria-label="Permalink for Section 5.4"></a></div>
        
        <ul>
          <li><a href="https://github.com/WICG/webcomponents/issues/716">Proposal Issue</a></li>
          <li><a href="https://github.com/w3c/tpac2023-breakouts/issues/15">Breakout Session Issue</a></li>
          <li><a href="https://github.com/WICG/webcomponents/blob/gh-pages/proposals/Scoped-Custom-Element-Registries.md">Proposed Spec</a></li>
        </ul>
        
      </section>
      <section id="key-scenarios-2"><div class="header-wrapper"><h3 id="x5-5-key-scenarios"><bdi class="secno">5.5 </bdi>Key Scenarios</h3><a class="self-link" href="#key-scenarios-2" aria-label="Permalink for Section 5.5"></a></div>
        
        <p>The issue with the current custom element definition approach is that there is only a single registry in the global space. Having a single global registry means also having the possibility of tag name or class collisions which will present problems when different released versions of the same custom element need to exist on a single HTML page at the same time.</p>

        <section id="design-system-use-case"><div class="header-wrapper"><h4 id="x5-5-1-design-system-use-case"><bdi class="secno">5.5.1 </bdi>Design system use case</h4><a class="self-link" href="#design-system-use-case" aria-label="Permalink for Section 5.5.1"></a></div>
        <p>Design system teams are largely responsible for making standalone reusable components that can be consumed in all manner of applications across an organization. Design system components can be small and directed (something like <code>x-label</code> or coarse-grained like <code>x-accordion</code>). For DRY principles, it is often very desirable for large coarse-grained components to internally (in the shadow root render template) use smaller components to keep logic encapsulated.</p>

        <p>When a design system component internally uses a component that a consuming application also uses, a version conflict can arise. If the large component uses <code>x-small-component</code> version 1.0.0, and the application uses <code>x-small-component</code> version 2.0.0, the custom element tag names will be the same, and both versions will attempt to register in the global registry.</p>

        <p>The first element registered will "win". The second registration will fail. Whichever element "wins" will cause functional failures for either the application or design system component, depending on which component registration "wins".</p>

        </section><section id="micro-front-end-use-case"><div class="header-wrapper"><h4 id="x5-5-2-micro-front-end-use-case"><bdi class="secno">5.5.2 </bdi>Micro-front end use case</h4><a class="self-link" href="#micro-front-end-use-case" aria-label="Permalink for Section 5.5.2"></a></div>

        <p>Micro-front-end architecture (MFE) is rising in popularity as a way to develop smaller pieces of what will be the final user-facing application, then assemble those pieces at runtime in some sort of shell application, service worker, etc. The micro-front-end architecture basically means that whole pieces of applications will be developed independently by separate probably-siloed teams then placed on the same page at runtime.</p>

        <p>When MFE remote component 1 uses a certain version of a component, and MFE remote component 2 uses a different version of that same component, and both attempt to register in the same global registry under the same tag name, version conflicts arise.</p>

        <p>If MFE 1 uses <code>x-component</code> version 1.0.0, and MFE 2 uses <code>x-component</code> 2.0.0, whichever component registration comes first "wins" and breaks the other MFE remote component. If 1.0.0 wins, then MFE 2 is broken because it is expecting 2.0.0 and use the 2.0.0 component API. Likewise, if 2.0.0 wins, MFE 1 breaks because it is dependent on the 1.0.0 component API which may not be supported in 2.0.0.</p>
      </section></section>
      <section id="polyfills"><div class="header-wrapper"><h3 id="x5-6-polyfills"><bdi class="secno">5.6 </bdi>Polyfills</h3><a class="self-link" href="#polyfills" aria-label="Permalink for Section 5.6"></a></div>
        
        <ul>
          <li><a href="https://github.com/webcomponents/polyfills/tree/master/packages/scoped-custom-element-registry">@webcomponents/scoped-custom-element-registry</a></li>
        </ul>

        <section id="mixin"><div class="header-wrapper"><h4 id="x5-6-1-mixin"><bdi class="secno">5.6.1 </bdi>Mixin</h4><a class="self-link" href="#mixin" aria-label="Permalink for Section 5.6.1"></a></div>
        <p>The mixins below are offered as helper libraries to consume the polyfill implementation in an consistent, automated way.</p>
        <ul>
          <li>
            <p>
              Open Web Components
              <a href="https://github.com/open-wc/open-wc/tree/master/packages/scoped-elements"> @open-wc/scoped-elements</a>
            </p>
          </li>
          <li>
            <p>
              Lit Labs
              <a href="https://github.com/lit/lit/tree/main/packages/labs/scoped-registry-mixin">@lit-labs/scoped-registry-mixin</a>
            </p>
          </li>
        </ul>
      </section></section>
      <section id="concerns-1"><div class="header-wrapper"><h3 id="x5-7-concerns"><bdi class="secno">5.7 </bdi>Concerns</h3><a class="self-link" href="#concerns-1" aria-label="Permalink for Section 5.7"></a></div>
        
        <ul>
          <li>Interaction with declarative shadow DOM (addressed)</li>
        </ul>
      </section>
      <section id="dissenting-opinion-1"><div class="header-wrapper"><h3 id="x5-8-dissenting-opinion"><bdi class="secno">5.8 </bdi>Dissenting Opinion</h3><a class="self-link" href="#dissenting-opinion-1" aria-label="Permalink for Section 5.8"></a></div>
        
        <ul>
          <li>None</li>
        </ul>
      </section>
      <section id="related-specs-2"><div class="header-wrapper"><h3 id="x5-9-related-specs"><bdi class="secno">5.9 </bdi>Related Specs</h3><a class="self-link" href="#related-specs-2" aria-label="Permalink for Section 5.9"></a></div>
        
        <ul>
          <li>---</li>
        </ul>
      </section>
      <section id="open-questions-2"><div class="header-wrapper"><h3 id="x5-10-open-questions"><bdi class="secno">5.10 </bdi>Open Questions</h3><a class="self-link" href="#open-questions-2" aria-label="Permalink for Section 5.10"></a></div>
        
        <ul>
          <li><a href="https://github.com/WICG/webcomponents/issues/914">[scoped-registries] Interaction with declarative shadow DOM #914</a></li>
          <li><a href="https://github.com/WICG/webcomponents/issues/907">Scoped Custom Element Registry: Moving elements with shadow roots between documents #907</a></li>
          <li><a href="https://github.com/WICG/webcomponents/issues/923">[scoped-registries] Element upgrade ordering #923</a></li>
        </ul>
      </section>
    </section>
    <section id="conformance"><div class="header-wrapper"><h2 id="x6-conformance"><bdi class="secno">6. </bdi>Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for Section 6."></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p>
      <p>
        This is required for specifications that contain normative material.
      </p>
    </section>
    <section id="index" class="appendix"><div class="header-wrapper"><h2 id="a-index"><bdi class="secno">A. </bdi>Index</h2><a class="self-link" href="#index" aria-label="Permalink for Appendix A."></a></div><section id="index-defined-here"><div class="header-wrapper"><h3 id="a-1-terms-defined-by-this-specification"><bdi class="secno">A.1 </bdi>Terms defined by this specification</h3><a class="self-link" href="#index-defined-here" aria-label="Permalink for Appendix A.1"></a></div>
    
    <ul class="index">
    
  </ul>
  </section><section id="index-defined-elsewhere"><div class="header-wrapper"><h3 id="a-2-terms-defined-by-reference"><bdi class="secno">A.2 </bdi>Terms defined by reference</h3><a class="self-link" href="#index-defined-elsewhere" aria-label="Permalink for Appendix A.2"></a></div>
    
    <ul class="index">
    
  </ul>
  </section></section>
  

<p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>